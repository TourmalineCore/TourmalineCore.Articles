# Web redirects на Apache: переезд старого сайта с одного домена на другой

- [Для чего это нужно](#для-чего-это-нужно)
- [Подготовка](#подготовка)
- [Работа с SEO тегами](#работа-с-seo-тегами)
- [Работа с Apache сервером](#работа-с-apache-сервером)
  * [RewriteCond и RewriteRule](#rewritecond-и-rewriterule)
  * [Redirect](#redirect)
- [Типы перенаправления](#типы-перенаправления)
- [Итог](#итог)

## Для чего это нужно

При реализации двух разных версий сайта, может произойти ситуация, что роботы поисковых гигантов могут посчитать новую версию сайта как фишинговую. Если такое прозойдет, то новый сайт после реализации SEO тегов не будет выдаваться в поисковых индексах. Для этого нужно настраивать редиректы.

Эта статья описывает решение проблемы в рамках Apache сервера в качестве доменного хранилища.

## Подготовка

Для начала нужно определиться какие проиндексированные страницы нужно сохранить в поиске.

Например, домашняя страница, одноименные страницы такие как `/about`, так же стрницы которые переделаны на новом сайте.
Те страницы которые уже не нужны или их просто не будет на новом сайте будем тоже перенаправлять но уже в другое место, об этом позже.

## Работа с SEO тегами

Для успешного переезда следует прописать к страницам, которые будут в дальнейшем проиндексированы, SEO теги. Такие как `title`, `description` и `keywords`.

![search-example](/articles/ru/web-redirect/search-example.png)

## Работа с Apache сервером

Для настроек редиректа старого сайта на сервере Apach нужно будет редактировать файл `.htaccess`. Гайд по использованию файла можно почитать [тут](https://httpd.apache.org/docs/current/howto/htaccess.html). В рамках статьи остановимся на функциях `RewriteRule`, `RewriteCond` и `Redirect`.

### RewriteCond и RewriteRule

`RewriteRule` позволяет перенаправлять пользователя на конкретную страницу по условию из `RewriteCond`.

> Пример постоянного перенаправления с `https://some-url.com/*` на `https://www.example.com/*` (так называемый [WildCard](https://docs.edgecast.com/cdn/Content/HRE/M/URL-Path-Wildcard.htm))
```
<IfModule mod_rewrite.c>
RewriteEngine on
</IfModule>

RewriteCond %{HTTP_HOST} ^(www\.)?some-url\.com$
RewriteRule ^(.*)$ "https://www.example.com/$1" [R=301,L]
```

`<IfModule mod_rewrite.c>` - проверка условия, что модуль mod_rewrite загружен 

`RewriteEngine on` - включение механизма перенаправления

`RewriteCond` - условие, при выполнении которого будет проверяться описанное в `RewriteRule` правило

`%{HTTP_HOST}` - переменная протоколов `http://` и `https://`. Все переменные можно посмотреть [тут](https://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewritecond)

`^(www\.)?` - перенаправление будет идти если обращаться по `www`

`RewriteRule` - объявления правила перенаправления

`^(.*)$` и `$1` - перенаправление будет идти по одноименному пути описанному в первом `RewriteCond` - `$`. Например с `https://some-url.com/about` на `https://www.example.com/about`

`[R=301,L]` - дополнительные параметры перенаправления, где R - это тип перенаправления (301 - постоянный, 302 - временный), а L - это аналог оператора break, который прервает проверку описанных в `RewriteCond` правил


Как можно заметить в условиях и правилах перенаправления зачастую используется **регулярные выражения**.

### Redirect

Для более простого варианта перенаправления с одной страницы на другую можно использовать функцию `Redirect`.

> Пример временного перенаправления конкретного пути страницы с `*/about` на `https://www.example.com/about`
```
Redirect 302 /about https://example.com/about
```

## Типы перенаправления

Существует два типа перенаправления: **301 - постоянный**, **302 - временный**.

Постоянное перенаправление сообщает поисковикам, что данная страница навсегда переехала на другой адресс. В следствии чего следующая индексация сайта уже будет собирать данные с нового адресса и постепенно заменять старые данные на новые. Таким образом получится, не теряя статистики и позиции на поисковой выдаче, безопасно перевезти сайт на новый адресс.

Временное же перенаправление сообщит поисковикам о том, что сайт еще не до конца переехал на новый адрес. Поэтому индексация уже по новому адрессу не проихойдет и сохранит данные в поисковике без изменений. Это будет полезно, если сайт готов не до конца или же еще нет уверенности, что настроенные роуты на сайте конечные.

Для начала рекомендуется везде настраивать **временное перенаправление**, если же есть полная уверенность, что все заработает отлично, то можно ставить и **постоянное**.

## Итог

В конце после успешно настроенного перенаправления можно проверить переходя по ссылкам перенаправленных страниц. Через какое-то время пройдет новое индесирование вашего сайта, когда это произойдет, то все ранее собранные данные индексации перезапишутся на новые, включая новые адреса страниц.